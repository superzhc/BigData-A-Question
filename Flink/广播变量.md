# 广播变量（Broadcast）

广播变量允许编程人员在每台机器上保持一个只读的缓存变量，而不是传送变量的副本给 Task。广播变量创建后，它可以运行在集群中的任何 Function 上，而不需要多次传递给集群节点。另外请记住，不要修改广播变量，这样才能确保每个节点获取到的值都是一致的。

用一句话解释，Broadcast 可以理解为一个公共的共享变量。可以把一个 DataSet（数据集）广播出去，不同的 Task 在节点上都能够获取到它，这个数据集在每个节点上只会存在一份。如果不使用 Broadcast，则在各节点的每个 Task 中都需要复制一份 DataSet 数据集，比较浪费内存（也就是一个节点中可能会存在多份 DataSet 数据）。

Broadcast 的使用步骤如下：

1. 初始化数据
   ```java
   DataSet<Integer> toBroadcast=env.fromElements(1,2,3);
   ```
2. 广播数据
   ```java
   env.withBroadcastSet(toBroadcast,"broadcastSetName");
   ```
3. 获取变量
   ```java
   Collection<Integer> broadcastSet=getRuntimeContext().getBroadcastVariable("broadcastSetName");
   ```

在使用 Broadcast 的时候需要注意以下事项：

- 广播变量存在于每个节点的内存中，它的数据量不能太大，因为广播出去的数据常驻内存，除非程序执行结束。
- 广播变量在初始化广播以后不支持修改，这样才能保证每个节点的数据都是一致的。
- 如果多个算子需要使用同一份数据集，那么需要在对应的多个算子后面分别注册广播变量。
- 广播变量只能在 Flink 批处理程序中才可以使用。